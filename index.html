<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcolatore NOI e Valutazione Immobile a Reddito</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .content {
            padding: 30px;
        }

        .section {
            margin-bottom: 30px;
            padding: 25px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 22px;
            display: flex;
            align-items: center;
        }

        .section-number {
            background: #667eea;
            color: white;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            margin-right: 12px;
            font-weight: bold;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-bottom: 15px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-weight: 600;
            font-size: 14px;
        }

        input[type="number"] {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        input[type="number"]:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .formula-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border: 2px solid #667eea;
        }

        .formula-box h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 18px;
        }

        .formula {
            background: #f0f4ff;
            padding: 15px;
            border-radius: 6px;
            font-family: 'Courier New', monospace;
            font-size: 15px;
            margin-bottom: 15px;
            overflow-x: auto;
        }

        .result {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            text-align: center;
            margin-top: 15px;
        }

        .result-value {
            font-size: 32px;
            margin-top: 10px;
        }

        .info-box {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #2196f3;
        }

        .info-box strong {
            color: #1976d2;
        }

        .warning-box {
            background: #fff3e0;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #ff9800;
        }

        .warning-box strong {
            color: #f57c00;
        }

        .success-box {
            background: #e8f5e9;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            border-left: 4px solid #4caf50;
        }

        .success-box strong {
            color: #388e3c;
        }

        .comparison {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .comparison-card {
            padding: 20px;
            border-radius: 8px;
            text-align: center;
        }

        .comparison-card.valuation {
            background: #e3f2fd;
            border: 2px solid #2196f3;
        }

        .comparison-card.market {
            background: #fff3e0;
            border: 2px solid #ff9800;
        }

        .comparison-card h4 {
            margin-bottom: 10px;
            font-size: 16px;
        }

        .comparison-card .value {
            font-size: 28px;
            font-weight: bold;
            margin: 10px 0;
        }

        .calculation-steps {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .step {
            padding: 15px;
            margin-bottom: 10px;
            background: #f5f5f5;
            border-radius: 6px;
            border-left: 3px solid #667eea;
        }

        .step-title {
            font-weight: bold;
            color: #667eea;
            margin-bottom: 5px;
        }

        .btn-calculate {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 18px;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
            font-weight: bold;
            transition: transform 0.2s;
            margin-top: 20px;
        }

        .btn-calculate:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .grid-2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }

        @media (max-width: 768px) {
            .input-row, .comparison, .grid-2 {
                grid-template-columns: 1fr;
            }

            .header h1 {
                font-size: 24px;
            }

            .content {
                padding: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìä Calcolatore NOI e Valutazione Immobile a Reddito</h1>
            <p>Analisi finanziaria professionale per investimenti immobiliari<br>
            Fonte: "Il Capitale" - di Marco Liera<br>
            <a href="https://markliera.substack.com/p/ilmattonenontradisce-come-calcolare" target="_blank" style="color: #fff; text-decoration: underline; opacity: 0.9;">üìÑ Leggi l'articolo originale</a></p>
        </div>

        <div class="content">
            <!-- SEZIONE 1: ENTRATE -->
            <div class="section">
                <h2><span class="section-number">1</span>Entrate Annuali</h2>
                
                <div class="info-box">
                    <strong>Nota importante:</strong> Gli oneri di pulizia ribaltati sui guests sono mostrati a titolo informativo, ma <strong>non vengono considerati nel calcolo del NOI</strong>, che si basa esclusivamente sul canone di locazione.
                </div>
                
                <div class="input-group">
                    <div class="input-row">
                        <div>
                            <label for="canone">Canone di Locazione Annuo (‚Ç¨) <span style="color: #667eea;">*per calcolo NOI</span></label>
                            <input type="number" id="canone" value="21352" step="0.01">
                        </div>
                        <div>
                            <label for="oneri">Oneri di Pulizia Ribaltati (‚Ç¨) <span style="color: #999; font-size: 12px;">*solo informativo</span></label>
                            <input type="number" id="oneri" value="4591" step="0.01">
                        </div>
                    </div>
                </div>

                <div class="formula-box">
                    <h3>Riepilogo Entrate</h3>
                    <div class="formula" id="formulaEntrate"></div>
                    <div class="result">
                        Entrate Lorde Totali (informativo)
                        <div class="result-value" id="entrateTotali"></div>
                    </div>
                    <div class="info-box" style="margin-top: 15px; background: #fff9e6; border-left-color: #ffc107;">
                        <strong>Per il calcolo del NOI</strong> verr√† utilizzato solo il <strong>Canone di Locazione</strong> di <span id="canonePerNOI" style="font-weight: bold; color: #667eea;"></span>
                    </div>
                </div>
            </div>

            <!-- SEZIONE 2: USCITE -->
            <div class="section">
                <h2><span class="section-number">2</span>Uscite e Costi Annuali</h2>
                
                <div class="input-group">
                    <div class="grid-2">
                        <div>
                            <label for="commissioni">Commissioni Portali (%)</label>
                            <input type="number" id="commissioni" value="15" step="0.1">
                        </div>
                        <div>
                            <label for="cedolare">Cedolare Secca (%)</label>
                            <input type="number" id="cedolare" value="21" step="0.1">
                        </div>
                    </div>

                    <div class="input-row">
                        <div>
                            <label for="energia">Spese Energia (‚Ç¨/anno)</label>
                            <input type="number" id="energia" value="1200" step="0.01">
                        </div>
                        <div>
                            <label for="wifi">Wi-Fi (‚Ç¨/anno)</label>
                            <input type="number" id="wifi" value="360" step="0.01">
                        </div>
                    </div>

                    <div class="input-row">
                        <div>
                            <label for="assicurazioni">Assicurazioni (‚Ç¨/anno)</label>
                            <input type="number" id="assicurazioni" value="500" step="0.01">
                        </div>
                        <div>
                            <label for="sicurezza">Sistemi di Sicurezza (‚Ç¨/anno)</label>
                            <input type="number" id="sicurezza" value="300" step="0.01">
                        </div>
                    </div>

                    <div class="input-row">
                        <div>
                            <label for="imu">IMU (‚Ç¨/anno)</label>
                            <input type="number" id="imu" value="800" step="0.01">
                        </div>
                        <div>
                            <label for="tari">TARI (‚Ç¨/anno)</label>
                            <input type="number" id="tari" value="250" step="0.01">
                        </div>
                    </div>

                    <div class="input-row">
                        <div>
                            <label for="condominio">Condominio (‚Ç¨/anno)</label>
                            <input type="number" id="condominio" value="1000" step="0.01">
                        </div>
                    </div>
                </div>

                <div class="formula-box">
                    <h3>Dettaglio Calcolo Uscite</h3>
                    <div class="calculation-steps" id="dettaglioUscite"></div>
                    <div class="result">
                        Uscite Totali Annue
                        <div class="result-value" id="usciteTotali"></div>
                    </div>
                </div>
            </div>

            <!-- SEZIONE 3: NOI -->
            <div class="section">
                <h2><span class="section-number">3</span>Net Operating Income (NOI)</h2>
                
                <div class="info-box">
                    <strong>Cos'√® il NOI?</strong><br>
                    Il Net Operating Income rappresenta il reddito operativo netto dell'immobile, ovvero il <strong>canone di locazione</strong> (esclusi gli oneri di pulizia ribaltati sui guests) meno tutte le spese operative. √à la metrica fondamentale per valutare la redditivit√† effettiva di un investimento immobiliare.
                </div>

                <div class="formula-box">
                    <h3>Formula NOI</h3>
                    <div class="formula">NOI = Canone di Locazione - Uscite Totali</div>
                    <div class="formula" id="formulaNOI"></div>
                    <div class="result">
                        Net Operating Income (NOI)
                        <div class="result-value" id="noiValue"></div>
                    </div>
                </div>
            </div>

            <!-- SEZIONE 4: CAP RATE -->
            <div class="section">
                <h2><span class="section-number">4</span>Capitalization Rate (Cap Rate)</h2>
                
                <div class="info-box">
                    <strong>Cos'√® il Cap Rate?</strong><br>
                    Il Cap Rate √® un tasso che tiene conto della rischiosit√† dell'investimento immobiliare. Si compone di due elementi:<br><br>
                    <strong>Cap Rate = Tasso Risk-Free + Premio per il Rischio</strong>
                </div>

                <div class="input-group">
                    <div class="input-row">
                        <div>
                            <label for="riskFree">Tasso Risk-Free (es. BTP 10 anni) (%)</label>
                            <input type="number" id="riskFree" value="3.4" step="0.1">
                        </div>
                        <div>
                            <label for="riskPremium">Premio per il Rischio (%)</label>
                            <input type="number" id="riskPremium" value="2.6" step="0.1">
                        </div>
                    </div>
                </div>

                <div class="formula-box">
                    <h3>Calcolo Cap Rate</h3>
                    <div class="formula" id="formulaCapRate"></div>
                    <div class="result">
                        Cap Rate Totale
                        <div class="result-value" id="capRateValue"></div>
                    </div>
                </div>
            </div>

            <!-- SEZIONE 5: VALUTAZIONE -->
            <div class="section">
                <h2><span class="section-number">5</span>Valutazione Intrinseca dell'Immobile</h2>
                
                <div class="info-box">
                    <strong>Formula di Valutazione</strong><br>
                    Il valore intrinseco dell'immobile si calcola dividendo il NOI per il Cap Rate. Questo metodo (Income Capitalization Approach) √® ampiamente utilizzato nella valutazione di immobili a reddito.
                </div>

                <div class="formula-box">
                    <h3>Formula di Valutazione</h3>
                    <div class="formula">Valore Intrinseco = NOI / Cap Rate</div>
                    <div class="formula" id="formulaValutazione"></div>
                    <div class="result">
                        Valore Intrinseco dell'Immobile
                        <div class="result-value" id="valoreIntrinseco"></div>
                    </div>
                </div>
            </div>

            <!-- SEZIONE 6: CONFRONTO CON MERCATO -->
            <div class="section">
                <h2><span class="section-number">6</span>Confronto con il Valore di Mercato</h2>
                
                <div class="input-group">
                    <label for="valoreMercato">Valore di Mercato dell'Immobile (‚Ç¨)</label>
                    <input type="number" id="valoreMercato" value="180000" step="100">
                </div>

                <div class="comparison">
                    <div class="comparison-card valuation">
                        <h4>üìä Valore Intrinseco</h4>
                        <div class="value" id="valoreIntrinsecoComp"></div>
                        <p>Basato su analisi NOI/Cap Rate</p>
                    </div>
                    <div class="comparison-card market">
                        <h4>üè™ Valore di Mercato</h4>
                        <div class="value" id="valoreMercatoComp"></div>
                        <p>Prezzo di vendita stimato</p>
                    </div>
                </div>

                <div id="conclusione"></div>
            </div>

            <button class="btn-calculate" onclick="calcolaTutto()">üîÑ Ricalcola Tutto</button>
        </div>
    </div>

    <script>
        function formatEuro(value) {
            return new Intl.NumberFormat('it-IT', {
                style: 'currency',
                currency: 'EUR',
                minimumFractionDigits: 2
            }).format(value);
        }

        function formatPercent(value) {
            return value.toFixed(2) + '%';
        }

        function calcolaTutto() {
            // STEP 1: Entrate
            const canone = parseFloat(document.getElementById('canone').value);
            const oneri = parseFloat(document.getElementById('oneri').value);
            const entrateLorde = canone + oneri;

            document.getElementById('formulaEntrate').textContent = 
                `${formatEuro(canone)} + ${formatEuro(oneri)} = ${formatEuro(entrateLorde)}`;
            document.getElementById('entrateTotali').textContent = formatEuro(entrateLorde);
            document.getElementById('canonePerNOI').textContent = formatEuro(canone);
            
            // Nota: per il calcolo NOI useremo solo il canone, non gli oneri

            // STEP 2: Uscite
            const percCommissioni = parseFloat(document.getElementById('commissioni').value);
            const percCedolare = parseFloat(document.getElementById('cedolare').value);
            const energia = parseFloat(document.getElementById('energia').value);
            const wifi = parseFloat(document.getElementById('wifi').value);
            const assicurazioni = parseFloat(document.getElementById('assicurazioni').value);
            const sicurezza = parseFloat(document.getElementById('sicurezza').value);
            const imu = parseFloat(document.getElementById('imu').value);
            const tari = parseFloat(document.getElementById('tari').value);
            const condominio = parseFloat(document.getElementById('condominio').value);

            const commissioni = canone * (percCommissioni / 100);
            const cedolare = canone * (percCedolare / 100);
            
            const usciteTotali = commissioni + cedolare + energia + wifi + 
                                assicurazioni + sicurezza + imu + tari + condominio;

            let dettaglioHTML = `
                <div class="step">
                    <div class="step-title">Commissioni Portali</div>
                    ${formatEuro(canone)} √ó ${percCommissioni}% = ${formatEuro(commissioni)}
                </div>
                <div class="step">
                    <div class="step-title">Cedolare Secca</div>
                    ${formatEuro(canone)} √ó ${percCedolare}% = ${formatEuro(cedolare)}
                </div>
                <div class="step">
                    <div class="step-title">Spese Fisse</div>
                    Energia: ${formatEuro(energia)}<br>
                    Wi-Fi: ${formatEuro(wifi)}<br>
                    Assicurazioni: ${formatEuro(assicurazioni)}<br>
                    Sicurezza: ${formatEuro(sicurezza)}<br>
                    IMU: ${formatEuro(imu)}<br>
                    TARI: ${formatEuro(tari)}<br>
                    Condominio: ${formatEuro(condominio)}
                </div>
            `;

            document.getElementById('dettaglioUscite').innerHTML = dettaglioHTML;
            document.getElementById('usciteTotali').textContent = formatEuro(usciteTotali);

            // STEP 3: NOI (usando solo il canone, non gli oneri)
            const noi = canone - usciteTotali;
            document.getElementById('formulaNOI').textContent = 
                `${formatEuro(canone)} - ${formatEuro(usciteTotali)} = ${formatEuro(noi)}`;
            document.getElementById('noiValue').textContent = formatEuro(noi);

            // STEP 4: Cap Rate
            const riskFree = parseFloat(document.getElementById('riskFree').value);
            const riskPremium = parseFloat(document.getElementById('riskPremium').value);
            const capRate = riskFree + riskPremium;

            document.getElementById('formulaCapRate').textContent = 
                `${formatPercent(riskFree)} + ${formatPercent(riskPremium)} = ${formatPercent(capRate)}`;
            document.getElementById('capRateValue').textContent = formatPercent(capRate);

            // STEP 5: Valutazione
            const valoreIntrinseco = noi / (capRate / 100);
            document.getElementById('formulaValutazione').textContent = 
                `${formatEuro(noi)} / ${formatPercent(capRate)} = ${formatEuro(valoreIntrinseco)}`;
            document.getElementById('valoreIntrinseco').textContent = formatEuro(valoreIntrinseco);

            // STEP 6: Confronto
            const valoreMercato = parseFloat(document.getElementById('valoreMercato').value);
            document.getElementById('valoreIntrinsecoComp').textContent = formatEuro(valoreIntrinseco);
            document.getElementById('valoreMercatoComp').textContent = formatEuro(valoreMercato);

            const differenza = valoreMercato - valoreIntrinseco;
            const percDifferenza = (differenza / valoreIntrinseco) * 100;

            let conclusioneHTML = '';
            if (differenza > 0) {
                conclusioneHTML = `
                    <div class="warning-box">
                        <strong>‚ö†Ô∏è Valutazione: Possibile Sopravvalutazione</strong><br><br>
                        Il valore di mercato (${formatEuro(valoreMercato)}) supera il valore intrinseco 
                        di ${formatEuro(differenza)} (+${formatPercent(percDifferenza)}).<br><br>
                        <strong>Considerazione finanziaria:</strong> Dal punto di vista strettamente finanziario, 
                        potrebbe essere opportuno valutare la vendita dell'immobile per capitalizzare 
                        sulla differenza di valore, che pu√≤ essere dovuta a dinamiche di mercato 
                        emotive o "irrazionali".
                    </div>
                `;
            } else if (differenza < 0) {
                conclusioneHTML = `
                    <div class="success-box">
                        <strong>‚úÖ Valutazione: Opportunit√† di Acquisto</strong><br><br>
                        Il valore di mercato (${formatEuro(valoreMercato)}) √® inferiore al valore intrinseco 
                        di ${formatEuro(Math.abs(differenza))} (${formatPercent(Math.abs(percDifferenza))}).<br><br>
                        <strong>Considerazione finanziaria:</strong> L'immobile potrebbe rappresentare una 
                        buona opportunit√† di investimento, in quanto il mercato lo sta prezzando al di sotto 
                        del suo valore basato sui flussi di cassa generati.
                    </div>
                `;
            } else {
                conclusioneHTML = `
                    <div class="info-box">
                        <strong>üìä Valutazione: Allineamento con il Mercato</strong><br><br>
                        Il valore di mercato √® sostanzialmente allineato con il valore intrinseco.<br><br>
                        <strong>Considerazione finanziaria:</strong> L'immobile √® prezzato in modo corretto 
                        rispetto ai flussi di cassa che genera.
                    </div>
                `;
            }

            document.getElementById('conclusione').innerHTML = conclusioneHTML;
        }

        // Calcola automaticamente all'avvio
        window.onload = calcolaTutto;

        // Ricalcola quando cambiano i valori
        document.querySelectorAll('input').forEach(input => {
            input.addEventListener('input', calcolaTutto);
        });
    </script>
</body>
</html>
